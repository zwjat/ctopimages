!function(e){e.Jcrop=function(t,n){function o(e){return e+"px"}function r(e){return z.baseClass+"-"+e}function i(){return e.fx.step.hasOwnProperty("backgroundColor")}function a(t){var n=e(t).offset();return[n.left,n.top]}function s(e){return[e.pageX-k[0],e.pageY-k[1]]}function c(t){"object"!=typeof t&&(t={}),z=e.extend(z,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof z[t]&&(z[t]=function(){})})}function u(e,t,n){if(k=a(B),oe.setCursor("move"===e?e:e+"-resize"),"move"===e)return oe.activateHandlers(function(e){var t=e;return re.watchKeys(),function(e){ee.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,ne.update()}}(t),p,n);var o=ee.getFixed(),r=d(e),i=ee.getCorner(d(r));ee.setPressed(ee.getCorner(r)),ee.setCurrent(i),oe.activateHandlers(function(e,t){return function(n){if(z.aspectRatio)switch(e){case"e":case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}ee.setCurrent(n),ne.update()}}(e,o),p,n)}function d(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function l(e){return function(t){return!(z.disabled||"move"===e&&!z.allowMove||(k=a(B),N=!0,u(e,s(t)),t.stopPropagation(),t.preventDefault(),1))}}function h(e,t,n){var o=e.width(),r=e.height();o>t&&t>0&&(o=t,r=t/e.width()*e.height()),r>n&&n>0&&(r=n,o=n/e.height()*e.width()),X=e.width()/o,G=e.height()/r,e.width(o).height(r)}function f(e){return{x:e.x*X,y:e.y*G,x2:e.x2*X,y2:e.y2*G,w:e.w*X,h:e.h*G}}function p(e){var t=ee.getFixed();t.w>z.minSelect[0]&&t.h>z.minSelect[1]?(ne.enableHandles(),ne.done()):ne.release(),oe.setCursor(z.allowSelect?"crosshair":"default")}function g(e){if(z.disabled)return!1;if(!z.allowSelect)return!1;N=!0,k=a(B),ne.disableHandles(),oe.setCursor("crosshair");var t=s(e);return ee.setPressed(t),ne.update(),oe.activateHandlers(b,p,"touch"===e.type.substring(0,5)),re.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function b(e){ee.setCurrent(e),ne.update()}function w(){var t=e("<div></div>").addClass(r("tracker"));return M&&t.css({opacity:0,backgroundColor:"white"}),t}function v(e){y([e[0]/X,e[1]/G,e[2]/X,e[3]/G]),z.onSelect.call(ie,f(ee.getFixed())),ne.enableHandles()}function y(e){ee.setPressed([e[0],e[1]]),ee.setCurrent([e[2],e[3]]),ne.update()}function m(){z.disabled=!0,ne.disableHandles(),ne.setCursor("default"),oe.setCursor("default")}function x(){z.disabled=!1,S()}function C(e,t,n){var o=t||z.bgColor;z.bgFade&&i()&&z.fadeTime&&!n?e.animate({backgroundColor:o},{queue:!1,duration:z.fadeTime}):e.css("backgroundColor",o)}function S(e){z.allowResize?e?ne.enableOnly():ne.enableHandles():ne.disableHandles(),oe.setCursor(z.allowSelect?"crosshair":"default"),ne.setCursor(z.allowMove?"move":"default"),z.hasOwnProperty("trueSize")&&(X=z.trueSize[0]/P,G=z.trueSize[1]/J),z.hasOwnProperty("setSelect")&&(v(z.setSelect),ne.done(),delete z.setSelect),te.refresh(),z.bgColor!=U&&(C(z.shade?te.getShades():A,z.shade&&z.shadeColor||z.bgColor),U=z.bgColor),Z!=z.bgOpacity&&(Z=z.bgOpacity,z.shade?te.refresh():ne.setBgOpacity(Z)),W=z.maxSize[0]||0,Y=z.maxSize[1]||0,q=z.minSize[0]||0,L=z.minSize[1]||0,z.hasOwnProperty("outerImage")&&(B.attr("src",z.outerImage),delete z.outerImage),ne.refresh()}var k,z=e.extend({},e.Jcrop.defaults),O=navigator.userAgent.toLowerCase(),M=/msie/.test(O),j=/msie [1-6]\./.test(O);"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),c(n);var F={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},H=e(t),D=!0;if("IMG"==t.tagName){if(0!=H[0].width&&0!=H[0].height)H.width(H[0].width),H.height(H[0].height);else{var I=new Image;I.src=H[0].src,H.width(I.width),H.height(I.height)}var B=H.clone().removeAttr("id").css(F).show();B.width(H.width()),B.height(H.height()),H.after(B).hide()}else B=H.css(F).show(),D=!1,null===z.shade&&(z.shade=!0);h(B,z.boxWidth,z.boxHeight);var P=B.width(),J=B.height(),A=e("<div />").width(P).height(J).addClass(r("holder")).css({position:"relative",backgroundColor:z.bgColor}).insertAfter(H).append(B);z.addClass&&A.addClass(z.addClass);var R=e("<div />"),T=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),K=e("<div />").width("100%").height("100%").css("zIndex",320),E=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=ee.getFixed();z.onDblClick.call(ie,e)}).insertBefore(B).append(T,K);D&&(R=e("<img />").attr("src",B.attr("src")).css(F).width(P).height(J),T.append(R)),j&&E.css({overflowY:"hidden"});var W,Y,q,L,X,G,N,V,Q=z.boundary,_=w().width(P+2*Q).height(J+2*Q).css({position:"absolute",top:o(-Q),left:o(-Q),zIndex:290}).mousedown(g),U=z.bgColor,Z=z.bgOpacity;k=a(B);var $=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var r=n[e],i=(r="on"+r)in o;i||(o.setAttribute(r,"return;"),i="function"==typeof o[r]),t[n[e]]=i}return t.touchstart&&t.touchend&&t.touchmove}catch(t){return!1}}return{createDragger:function(e){return function(t){return!(z.disabled||"move"===e&&!z.allowMove||(k=a(B),N=!0,u(e,s($.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),1))}},newSelection:function(e){return g($.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:!0===z.touchSupport||!1===z.touchSupport?z.touchSupport:e()}}(),ee=function(){function e(){if(!z.aspectRatio)return function(){var e,t=c-a,r=u-s;return W&&Math.abs(t)>W&&(c=t>0?a+W:a-W),Y&&Math.abs(r)>Y&&(u=r>0?s+Y:s-Y),L/G&&Math.abs(r)<L/G&&(u=r>0?s+L/G:s-L/G),q/X&&Math.abs(t)<q/X&&(c=t>0?a+q/X:a-q/X),a<0&&(c-=a,a-=a),s<0&&(u-=s,s-=s),c<0&&(a-=c,c-=c),u<0&&(s-=u,u-=u),c>P&&(a-=e=c-P,c-=e),u>J&&(s-=e=u-J,u-=e),a>P&&(u-=e=a-J,s-=e),s>J&&(u-=e=s-J,s-=e),o(n(a,s,c,u))}();var e,t,r,i,d=z.aspectRatio,l=z.minSize[0]/X,h=z.maxSize[0]/X,f=z.maxSize[1]/G,p=c-a,g=u-s,b=Math.abs(p),w=Math.abs(g);return 0===h&&(h=10*P),0===f&&(f=10*J),b/w<d?(t=u,r=w*d,(e=p<0?a-r:r+a)<0?(e=0,i=Math.abs((e-a)/d),t=g<0?s-i:i+s):e>P&&(e=P,i=Math.abs((e-a)/d),t=g<0?s-i:i+s)):(e=c,i=b/d,(t=g<0?s-i:s+i)<0?(t=0,r=Math.abs((t-s)*d),e=p<0?a-r:r+a):t>J&&(t=J,r=Math.abs(t-s)*d,e=p<0?a-r:r+a)),e>a?(e-a<l?e=a+l:e-a>h&&(e=a+h),t=t>s?s+(e-a)/d:s-(e-a)/d):e<a&&(a-e<l?e=a-l:a-e>h&&(e=a-h),t=t>s?s+(a-e)/d:s-(a-e)/d),e<0?(a-=e,e=0):e>P&&(a-=e-P,e=P),t<0?(s-=t,t=0):t>J&&(s-=t-J,t=J),o(n(a,s,e,t))}function t(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>P&&(e[0]=P),e[1]>J&&(e[1]=J),[e[0],e[1]]}function n(e,t,n,o){var r=e,i=n,a=t,s=o;return n<e&&(r=n,i=e),o<t&&(a=o,s=t),[r,a,i,s]}function o(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var r,i,a=0,s=0,c=0,u=0;return{flipCoords:n,setPressed:function(e){e=t(e),c=a=e[0],u=s=e[1]},setCurrent:function(e){e=t(e),r=e[0]-c,i=e[1]-u,c=e[0],u=e[1]},getOffset:function(){return[r,i]},moveOffset:function(e){var t=e[0],n=e[1];0>a+t&&(t-=t+a),0>s+n&&(n-=n+s),J<u+n&&(n+=J-(u+n)),P<c+t&&(t+=P-(c+t)),a+=t,c+=t,s+=n,u+=n},getCorner:function(t){var n=e();switch(t){case"ne":return[n.x2,n.y];case"nw":return[n.x,n.y];case"se":return[n.x2,n.y2];case"sw":return[n.x,n.y2]}},getFixed:e}}(),te=function(){function t(){return n(ee.getFixed())}function n(e){h.top.css({left:o(e.x),width:o(e.w),height:o(e.y)}),h.bottom.css({top:o(e.y2),left:o(e.x),width:o(e.w),height:o(J-e.y2)}),h.right.css({left:o(e.x2),width:o(P-e.x2)}),h.left.css({width:o(e.x)})}function r(){return e("<div />").css({position:"absolute",backgroundColor:z.shadeColor||z.bgColor}).appendTo(l)}function i(){d||(d=!0,l.insertBefore(B),t(),ne.setBgOpacity(1,0,1),R.hide(),a(z.shadeColor||z.bgColor,1),ne.isAwake()?c(z.bgOpacity,1):c(1,1))}function a(e,t){C(u(),e,t)}function s(){d&&(l.remove(),R.show(),d=!1,ne.isAwake()?ne.setBgOpacity(z.bgOpacity,1,1):(ne.setBgOpacity(1,1,1),ne.disableHandles()),C(A,0,1))}function c(e,t){d&&(z.bgFade&&!t?l.animate({opacity:1-e},{queue:!1,duration:z.fadeTime}):l.css({opacity:1-e}))}function u(){return l.children()}var d=!1,l=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),h={top:r(),left:r().height(J),right:r().height(J),bottom:r()};return{update:t,updateRaw:n,getShades:u,setBgColor:a,enable:i,disable:s,resize:function(e,t){h.left.css({height:o(t)}),h.right.css({height:o(t)})},refresh:function(){z.shade?i():s(),ne.isAwake()&&c(z.bgOpacity)},opacity:c}}(),ne=function(){function t(t){var n=e("<div />").css({position:"absolute",opacity:z.borderOpacity}).addClass(r(t));return T.append(n),n}function n(t,n){var o=e("<div />").mousedown(l(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return $.support&&o.bind("touchstart.jcrop",$.createDragger(t)),K.append(o),o}function i(e){var t=z.handleSize,o=n(e,v++).css({opacity:z.handleOpacity}).addClass(r("handle"));return t&&o.width(t).height(t),o}function a(e){return n(e,v++).addClass("jcrop-dragbar")}function s(){var e=ee.getFixed();ee.setPressed([e.x,e.y]),ee.setCurrent([e.x2,e.y2]),c()}function c(e){if(b)return u(e)}function u(e){var t=ee.getFixed();(function(e,t){E.width(e).height(t)})(t.w,t.h),function(e,t){z.shade||R.css({top:o(-t),left:o(-e)}),E.css({top:o(t),left:o(e)})}(t.x,t.y),z.shade&&te.updateRaw(t),b||(E.show(),z.shade?te.opacity(Z):d(Z,!0),b=!0),e?z.onSelect.call(ie,f(t)):z.onChange.call(ie,f(t))}function d(e,t,n){(b||t)&&(z.bgFade&&!n?B.animate({opacity:e},{queue:!1,duration:z.fadeTime}):B.css("opacity",e))}function h(){if(C=!0,z.allowResize)return K.show(),!0}function p(){C=!1,K.hide()}function g(e){e?(V=!0,p()):(V=!1,h())}var b,v=370,y={},m={},x={},C=!1;z.dragEdges&&e.isArray(z.createDragbars)&&function(e){var t;for(t=0;t<e.length;t++)x[e[t]]=a(e[t])}(z.createDragbars),e.isArray(z.createHandles)&&function(e){var t;for(t=0;t<e.length;t++)m[e[t]]=i(e[t])}(z.createHandles),z.drawBorders&&e.isArray(z.createBorders)&&function(e){var n,o;for(o=0;o<e.length;o++){switch(e[o]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}y[e[o]]=t(n)}}(z.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var S=w().mousedown(l("move")).css({cursor:"move",position:"absolute",zIndex:360});return $.support&&S.bind("touchstart.jcrop",$.createDragger("move")).attr("id","shape_tracker"),T.append(S),p(),{updateVisible:c,update:u,release:function(){p(),E.hide(),z.shade?te.opacity(1):d(1),b=!1,z.onRelease.call(ie)},refresh:s,isAwake:function(){return b},setCursor:function(e){S.css("cursor",e)},enableHandles:h,enableOnly:function(){C=!0},showHandles:function(){C&&K.show()},disableHandles:p,animMode:g,setBgOpacity:d,done:function(){g(!1),s()}}}(),oe=function(){function t(t){_.css({zIndex:450}),t?e(document).bind("touchmove.jcrop",i).bind("touchend.jcrop",a):d&&e(document).bind("mousemove.jcrop",o).bind("mouseup.jcrop",r)}function n(){_.css({zIndex:290}),e(document).unbind(".jcrop")}function o(e){return c(s(e)),!1}function r(e){return e.preventDefault(),e.stopPropagation(),N&&(N=!1,u(s(e)),ne.isAwake()&&z.onSelect.call(ie,f(ee.getFixed())),n(),c=function(){},u=function(){}),!1}function i(e){return c(s($.cfilter(e))),!1}function a(e){return r($.cfilter(e))}var c=function(){},u=function(){},d=z.trackDocument;return d||_.mousemove(o).mouseup(r).mouseout(r),B.before(_),{activateHandlers:function(e,n,o){return N=!0,c=e,u=n,t(o),!1},setCursor:function(e){_.css("cursor",e)}}}(),re=function(){function t(e,t,n){z.allowMove&&(ee.moveOffset([t,n]),ne.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}var n=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px",display:"none"}).addClass("jcrop-keymgr"),o=e("<div />").css({position:"absolute",overflow:"hidden"}).append(n);return z.keySupport&&(n.keydown(function(e){if(e.ctrlKey||e.metaKey)return!0;var n=!!e.shiftKey?10:1;switch(e.keyCode){case 37:t(e,-n,0);break;case 39:t(e,n,0);break;case 38:t(e,0,-n);break;case 40:t(e,0,n);break;case 27:z.allowSelect&&ne.release();break;case 9:return!0}return!1}).blur(function(e){n.hide()}),j||!z.fixedSupport?(n.css({position:"absolute",left:"-20px"}),o.append(n).insertBefore(B)):n.insertBefore(B)),{watchKeys:function(){z.keySupport&&(n.show(),n.focus())}}}();$.support&&_.bind("touchstart.jcrop",$.newSelection),K.hide(),S(!0);var ie={setImage:function(e,t){ne.release(),m();var n=new Image;n.onload=function(){var o=n.width,r=n.height,i=z.boxWidth,a=z.boxHeight;B.width(o).height(r),B.attr("src",e),R.attr("src",e),h(B,i,a),P=B.width(),J=B.height(),R.width(P).height(J),_.width(P+2*Q).height(J+2*Q),A.width(P).height(J),te.resize(P,J),x(),"function"==typeof t&&t.call(ie)},n.src=e},animateTo:function(e,t){function n(){window.setTimeout(v,l)}var o=e[0]/X,r=e[1]/G,i=e[2]/X,a=e[3]/G;if(!V){var s=ee.flipCoords(o,r,i,a),c=ee.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=z.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],b=0,w=z.swingSpeed;o=d[0],r=d[1],i=d[2],a=d[3],ne.animMode(!0);var v=function(){b+=(100-b)/w,d[0]=Math.round(o+b/100*h),d[1]=Math.round(r+b/100*f),d[2]=Math.round(i+b/100*p),d[3]=Math.round(a+b/100*g),b>=99.8&&(b=100),b<100?(y(d),n()):(ne.done(),ne.animMode(!1),"function"==typeof t&&t.call(ie))};n()}},setSelect:v,setOptions:function(e){c(e),S()},tellSelect:function(){return f(ee.getFixed())},tellScaled:function(){return ee.getFixed()},setClass:function(e){A.removeClass().addClass(r("holder")).addClass(e)},disable:m,enable:x,cancel:function(){ne.done(),oe.activateHandlers(null,null)},release:ne.release,destroy:function(){A.remove(),H.show(),H.css("visibility","visible"),e(t).removeData("Jcrop")},focus:re.watchKeys,getBounds:function(){return[P*X,J*G]},getWidgetSize:function(){return[P,J]},getScaleFactor:function(){return[X,G]},getOptions:function(){return z},ui:{holder:A,selection:E}};return M&&A.bind("selectstart",function(){return!1}),H.data("Jcrop",ie),ie},e.fn.Jcrop=function(t,n){var o;return this.each(function(){if(e(this).data("Jcrop")){if("api"===t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),o=e.Jcrop(this,t),e.isFunction(n)&&n.call(o)}):(e(this).css({display:"block",visibility:"hidden"}),o=e.Jcrop(this,t),e.isFunction(n)&&n.call(o))}),this},e.Jcrop.Loader=function(t,n,o){var r=e(t),i=r[0];r.bind("load.jcloader",function t(){i.complete?(r.unbind(".jcloader"),e.isFunction(n)&&n.call(i)):window.setTimeout(t,50)}).bind("error.jcloader",function(t){r.unbind(".jcloader"),e.isFunction(o)&&o.call(i)}),i.complete&&e.isFunction(n)&&(r.unbind(".jcloader"),n.call(i))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"white",bgOpacity:.2,bgFade:!0,borderOpacity:.4,handleOpacity:1,handleSize:15,aspectRatio:0,keySupport:null,createHandles:["nw","ne","se","sw"],createDragbars:["n","s","e","w"],drawBorders:!0,dragEdges:null,fixedSupport:!0,touchSupport:!0,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:100,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);